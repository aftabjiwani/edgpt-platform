<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdGPT Demo - Interactive School Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .demo-header h1 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .demo-header p {
            font-size: 18px;
            opacity: 0.9;
        }
        
        .chat-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .chat-info h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .chat-info p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .voice-controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .voice-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .voice-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .voice-toggle.active {
            background: #48bb78;
        }
        
        .voice-status {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .chat-messages {
            height: 500px;
            overflow-y: auto;
            padding: 20px;
            background: #f8fafc;
        }
        
        .message {
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
        }
        
        .message.user {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            flex-shrink: 0;
        }
        
        .message.assistant .message-avatar {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .message.user .message-avatar {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }
        
        .message-content {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 20px;
            line-height: 1.5;
        }
        
        .message.assistant .message-content {
            background: white;
            color: #2d3748;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .message.user .message-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .quick-actions {
            padding: 20px;
            background: white;
            border-top: 1px solid #e2e8f0;
        }
        
        .quick-actions h4 {
            color: #4a5568;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .action-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .action-btn.enrollment {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }
        
        .action-btn.forms {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
        }
        
        .action-btn.events {
            background: linear-gradient(135deg, #9f7aea, #805ad5);
        }
        
        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .chat-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        .chat-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .voice-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: white;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .voice-btn:hover {
            transform: scale(1.1);
        }
        
        .voice-btn.listening {
            background: linear-gradient(135deg, #48bb78, #38a169);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .send-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .send-btn:hover {
            transform: scale(1.1);
        }
        
        .typing-indicator {
            display: none;
            padding: 15px 20px;
            background: white;
            border-radius: 20px;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 70%;
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #cbd5e0;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                background: #cbd5e0;
            }
            30% {
                transform: translateY(-10px);
                background: #667eea;
            }
        }
        
        .form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .form-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .form-header h3 {
            color: #4a5568;
            font-size: 24px;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #a0aec0;
        }
        
        .form-field {
            margin-bottom: 20px;
        }
        
        .form-field label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
        }
        
        .form-field input,
        .form-field select,
        .form-field textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        .form-field input:focus,
        .form-field select:focus,
        .form-field textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-field textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-submit {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .form-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }
        
        @media (max-width: 768px) {
            .demo-container {
                padding: 10px;
            }
            
            .demo-header h1 {
                font-size: 28px;
            }
            
            .chat-container {
                margin: 0;
            }
            
            .chat-messages {
                height: 400px;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .chat-input-container {
                flex-wrap: wrap;
            }
            
            .chat-input {
                min-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>üéì EdGPT Interactive Demo</h1>
            <p>Experience the future of school communication - try our intelligent assistant!</p>
        </div>
        
        <div class="chat-container">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="chat-avatar">ü§ñ</div>
                <div class="chat-info">
                    <h3>EdGPT for Riverside Elementary</h3>
                    <p>Your intelligent school assistant - available 24/7</p>
                </div>
            </div>
            
            <!-- Voice Controls -->
            <div class="voice-controls">
                <button class="voice-toggle" id="voiceToggle" onclick="toggleVoice()">
                    üé§ Enable Voice Conversation
                </button>
                <div class="voice-status" id="voiceStatus">
                    Professional American female voice will respond to your spoken queries
                </div>
            </div>
            
            <!-- Chat Messages -->
            <div class="chat-messages" id="chatMessages">
                <div class="message assistant">
                    <div class="message-avatar">ü§ñ</div>
                    <div class="message-content">
                        Welcome to Riverside Elementary! I'm EdGPT, your intelligent school assistant. I can help you with enrollment forms, school information, events, and much more. I can also connect you directly with our staff for personalized assistance. How can I help you today?
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="quick-actions">
                <h4>Quick Actions:</h4>
                <div class="action-buttons">
                    <button class="action-btn enrollment" onclick="sendQuickMessage('enrollment')">
                        üìã Student Enrollment
                    </button>
                    <button class="action-btn" onclick="sendQuickMessage('school hours')">
                        üïê School Hours
                    </button>
                    <button class="action-btn forms" onclick="sendQuickMessage('forms')">
                        üìù School Forms
                    </button>
                    <button class="action-btn events" onclick="sendQuickMessage('events')">
                        üìÖ Upcoming Events
                    </button>
                    <button class="action-btn" onclick="sendQuickMessage('lunch menu')">
                        üçé Lunch Menu
                    </button>
                    <button class="action-btn" onclick="sendQuickMessage('contact staff')">
                        üë• Contact Staff
                    </button>
                </div>
            </div>
            
            <!-- Chat Input -->
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Type your question here..." onkeypress="handleKeyPress(event)">
                <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceInput()" title="Voice Input">
                    üé§
                </button>
                <button class="send-btn" onclick="sendMessage()" title="Send Message">
                    üì§
                </button>
            </div>
            
            <!-- Typing Indicator -->
            <div class="message assistant" style="margin-bottom: 20px; margin-left: 20px;">
                <div class="message-avatar">ü§ñ</div>
                <div class="typing-indicator" id="typingIndicator">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Form Modal -->
    <div class="form-modal" id="formModal">
        <div class="form-content">
            <div class="form-header">
                <h3 id="formTitle">Student Enrollment Form</h3>
                <button class="close-btn" onclick="closeForm()">&times;</button>
            </div>
            <div id="formFields">
                <!-- Form fields will be dynamically generated here -->
            </div>
        </div>
    </div>
    
    <script>
        let voiceEnabled = false;
        let isListening = false;
        let recognition = null;
        let synthesis = window.speechSynthesis;
        
        // Initialize speech recognition if available
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('chatInput').value = transcript;
                sendMessage();
            };
            
            recognition.onend = function() {
                isListening = false;
                document.getElementById('voiceBtn').classList.remove('listening');
            };
        }
        
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const toggle = document.getElementById('voiceToggle');
            const status = document.getElementById('voiceStatus');
            
            if (voiceEnabled) {
                toggle.textContent = 'üîá Disable Voice Conversation';
                toggle.classList.add('active');
                status.textContent = 'Voice conversation enabled - EdGPT will speak responses to your voice queries';
            } else {
                toggle.textContent = 'üé§ Enable Voice Conversation';
                toggle.classList.remove('active');
                status.textContent = 'Professional American female voice will respond to your spoken queries';
            }
        }
        
        function toggleVoiceInput() {
            if (!recognition) {
                alert('Speech recognition is not supported in your browser');
                return;
            }
            
            if (isListening) {
                recognition.stop();
                isListening = false;
                document.getElementById('voiceBtn').classList.remove('listening');
            } else {
                recognition.start();
                isListening = true;
                document.getElementById('voiceBtn').classList.add('listening');
            }
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        function sendQuickMessage(type) {
            const messages = {
                'enrollment': 'I need help with student enrollment',
                'school hours': 'What are the school hours?',
                'forms': 'What forms are available?',
                'events': 'What events are coming up?',
                'lunch menu': 'What\'s on the lunch menu today?',
                'contact staff': 'I need to contact a staff member'
            };
            
            const message = messages[type] || type;
            document.getElementById('chatInput').value = message;
            sendMessage();
        }
        
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate API call delay
            setTimeout(() => {
                hideTypingIndicator();
                handleResponse(message);
            }, 1500);
        }
        
        function addMessage(content, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = sender === 'user' ? 'üë§' : 'ü§ñ';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">${content}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'block';
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }
        
        function handleResponse(message) {
            const messageLower = message.toLowerCase();
            let response = "Thank you for your question! I'm EdGPT, your school's intelligent assistant. I can help you with enrollment forms, permission slips, staff contacts, school information, and much more. I can also connect you directly with our staff for personalized assistance. How can I help you today?";
            let showForm = false;
            let formType = '';
            
            // Enhanced responses with form integration
            if (messageLower.includes('enrollment') || messageLower.includes('enroll')) {
                response = "I'd be happy to help you with enrollment! I can provide you with our enrollment form right here. Would you like me to show you the enrollment application form? I can also connect you with our admissions office for personalized assistance.";
                showForm = true;
                formType = 'enrollment';
            } else if (messageLower.includes('form') || messageLower.includes('forms')) {
                response = "I can help you access all the forms you need! EdGPT has integrated forms for enrollment, field trip permissions, lunch applications, transportation requests, and more. Which specific form are you looking for?";
            } else if (messageLower.includes('field trip') || messageLower.includes('permission')) {
                response = "I can help you with field trip permission forms! Our upcoming Science Museum trip on March 15th needs permission slips. Would you like me to show you the permission form?";
                showForm = true;
                formType = 'field_trip';
            } else if (messageLower.includes('lunch') && messageLower.includes('application')) {
                response = "I can help you with our lunch program application! Would you like me to show you the free/reduced lunch application form?";
                showForm = true;
                formType = 'lunch_application';
            } else if (messageLower.includes('school hours') || messageLower.includes('hours')) {
                response = "Our school hours are Monday-Friday, 8:00 AM to 3:30 PM. Early drop-off is available starting at 7:30 AM for working parents, and our after-school care program extends until 6:00 PM.";
            } else if (messageLower.includes('lunch menu') || messageLower.includes('menu')) {
                response = "Today's lunch features grilled chicken with rice, fresh vegetables, and fruit. We also have vegetarian options. All meals meet USDA nutrition standards. Would you like me to show you our lunch application form?";
            } else if (messageLower.includes('events') || messageLower.includes('calendar')) {
                response = "Upcoming events include Parent-Teacher Conferences (March 15-17), Spring Science Fair (March 22), and Field Day (April 5). I can also show you permission forms for upcoming field trips.";
            } else if (messageLower.includes('staff') || messageLower.includes('contact')) {
                response = "Our dedicated staff includes Principal Johnson and 24 certified teachers. I can connect you directly with any staff member through our message system. Who would you like to reach?";
            } else if (messageLower.includes('safety') || messageLower.includes('emergency')) {
                response = "Student safety is our top priority. We have secure entry systems and regular safety drills. I can provide you with our complete safety handbook and emergency procedures.";
            } else if (messageLower.includes('transportation') || messageLower.includes('bus')) {
                response = "We provide bus transportation for students living more than 1 mile from school. Would you like me to show you our transportation request form?";
            } else if (messageLower.includes('volunteer')) {
                response = "We welcome parent volunteers! I can provide you with our volunteer application form and background check requirements right here.";
            }
            
            addMessage(response, 'assistant');
            
            // Speak response if voice is enabled and this was a voice query
            if (voiceEnabled && isListening) {
                speakResponse(response);
            }
            
            // Show form if applicable
            if (showForm) {
                setTimeout(() => {
                    showForm(formType);
                }, 1000);
            }
        }
        
        function speakResponse(text) {
            if (synthesis) {
                // Cancel any ongoing speech
                synthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Try to use a female voice
                const voices = synthesis.getVoices();
                const femaleVoice = voices.find(voice => 
                    voice.name.includes('Female') || 
                    voice.name.includes('Zira') || 
                    voice.name.includes('Samantha') ||
                    voice.gender === 'female'
                );
                
                if (femaleVoice) {
                    utterance.voice = femaleVoice;
                }
                
                utterance.rate = 0.9;
                utterance.pitch = 1.1;
                utterance.volume = 0.8;
                
                synthesis.speak(utterance);
            }
        }
        
        function showForm(formType) {
            // Get form data from API
            fetch(`/api/get_form/${formType}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayForm(data.form);
                    } else {
                        alert('Form not available at the moment');
                    }
                })
                .catch(error => {
                    console.error('Error loading form:', error);
                    alert('Error loading form');
                });
        }
        
        function displayForm(form) {
            document.getElementById('formTitle').textContent = form.name;
            
            const fieldsContainer = document.getElementById('formFields');
            fieldsContainer.innerHTML = '';
            
            // Add form description
            if (form.description) {
                const description = document.createElement('p');
                description.style.marginBottom = '20px';
                description.style.color = '#718096';
                description.textContent = form.description;
                fieldsContainer.appendChild(description);
            }
            
            // Add form fields
            form.fields.forEach(field => {
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'form-field';
                
                const label = document.createElement('label');
                label.textContent = field.label + (field.required ? ' *' : '');
                fieldDiv.appendChild(label);
                
                let input;
                if (field.type === 'select') {
                    input = document.createElement('select');
                    field.options.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        input.appendChild(optionElement);
                    });
                } else if (field.type === 'textarea') {
                    input = document.createElement('textarea');
                } else if (field.type === 'radio') {
                    const radioContainer = document.createElement('div');
                    field.options.forEach(option => {
                        const radioDiv = document.createElement('div');
                        radioDiv.style.marginBottom = '8px';
                        
                        const radioInput = document.createElement('input');
                        radioInput.type = 'radio';
                        radioInput.name = field.name;
                        radioInput.value = option;
                        radioInput.id = `${field.name}_${option}`;
                        
                        const radioLabel = document.createElement('label');
                        radioLabel.htmlFor = radioInput.id;
                        radioLabel.textContent = option;
                        radioLabel.style.marginLeft = '8px';
                        
                        radioDiv.appendChild(radioInput);
                        radioDiv.appendChild(radioLabel);
                        radioContainer.appendChild(radioDiv);
                    });
                    fieldDiv.appendChild(radioContainer);
                    fieldsContainer.appendChild(fieldDiv);
                    return;
                } else {
                    input = document.createElement('input');
                    input.type = field.type;
                }
                
                input.name = field.name;
                input.required = field.required;
                
                if (field.placeholder) {
                    input.placeholder = field.placeholder;
                }
                
                if (field.value) {
                    input.value = field.value;
                }
                
                if (field.readonly) {
                    input.readOnly = true;
                    input.style.backgroundColor = '#f7fafc';
                }
                
                fieldDiv.appendChild(input);
                fieldsContainer.appendChild(fieldDiv);
            });
            
            // Add submit button
            const submitBtn = document.createElement('button');
            submitBtn.className = 'form-submit';
            submitBtn.textContent = 'Submit Form';
            submitBtn.onclick = () => submitForm(form.name);
            fieldsContainer.appendChild(submitBtn);
            
            // Show modal
            document.getElementById('formModal').style.display = 'flex';
        }
        
        function closeForm() {
            document.getElementById('formModal').style.display = 'none';
        }
        
        function submitForm(formName) {
            const formData = {};
            const inputs = document.querySelectorAll('#formFields input, #formFields select, #formFields textarea');
            
            inputs.forEach(input => {
                if (input.type === 'radio') {
                    if (input.checked) {
                        formData[input.name] = input.value;
                    }
                } else {
                    formData[input.name] = input.value;
                }
            });
            
            // Submit form data
            fetch('/api/submit_form', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    form_name: formName,
                    form_data: formData,
                    submitter_info: {
                        name: formData.parent_name || formData.student_name || 'Demo User',
                        email: formData.parent_email || formData.email || 'demo@example.com',
                        phone: formData.parent_phone || formData.phone || ''
                    }
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    closeForm();
                    addMessage(`Great! Your ${formName} has been submitted successfully. You'll receive a confirmation email shortly.`, 'assistant');
                } else {
                    alert('Error submitting form: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error submitting form:', error);
                alert('Error submitting form');
            });
        }
        
        // Close modal when clicking outside
        document.getElementById('formModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeForm();
            }
        });
        
        // Load voices when available
        if (synthesis) {
            synthesis.onvoiceschanged = function() {
                // Voices are now loaded
            };
        }
    </script>
</body>
</html>

